<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Mapa con geometrías personalizadas</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mapbox-gl-draw/1.3.2/mapbox-gl-draw.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/mapbox-gl-draw/1.3.2/mapbox-gl-draw.css" rel="stylesheet">
<style>
       body {
           margin: 0;
           padding: 0;
       }
       #map {
           position: absolute;
           top: 0;
           bottom: 0;
           width: 100%;
       }
       #coordinates {
           position: absolute;
           bottom: 0;
           left: 0;
           margin: 20px;
           background: white;
           padding: 10px;
           border-radius: 3px;
           font-family: Arial, sans-serif;
           font-size: 12px;
           box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
           z-index: 1;
       }
       .mapboxgl-ctrl.mapboxgl-ctrl-group {
           margin-top: 10px;
       }
</style>
</head>
<body>
<div id="map"></div>
<div id="coordinates">Las coordenadas aparecerán aquí</div>
<script>
   // Tu token de Mapbox
   mapboxgl.accessToken = 'pk.eyJ1IjoiY2JyZWRlc2lnbiIsImEiOiJjbGE4MndlZ3AwMjZjM3ZtaXUwdG1rdjNvIn0.xmG8u3enVaFzhNdsS_H0Ug';
   // Crear el mapa
   const map = new mapboxgl.Map({
       container: 'map',
       style: 'mapbox://styles/mapbox/streets-v11',
       center: [-3.70379, 40.41678],
       zoom: 12
   });
   // Añadir controles de navegación al mapa
   map.addControl(new mapboxgl.NavigationControl());
   // Inicializar Mapbox Draw
   const Draw = new MapboxDraw({
       displayControlsDefault: false,
       controls: {
           point: true,
           line_string: true,
           polygon: true,
           trash: true,
           combine_features: false,
           uncombine_features: false
       }
   });
   map.addControl(Draw);
   // Contenedor para las coordenadas
   const coordinatesContainer = document.getElementById('coordinates');
   // Escuchar cambios en las geometrías dibujadas
   map.on('draw.create', updateCoordinates);
   map.on('draw.update', updateCoordinates);
   map.on('draw.delete', updateCoordinates);
   function updateCoordinates(e) {
       const data = Draw.getAll();
       if (data.features.length > 0) {
           const geometries = data.features.map(feature => {
               return {
                   type: feature.geometry.type,
                   coordinates: feature.geometry.coordinates
               };
           });
           coordinatesContainer.innerHTML = `
<strong>Geometrías dibujadas:</strong><br>
               ${JSON.stringify(geometries, null, 2)}
           `;
       } else {
           coordinatesContainer.innerHTML = 'Las coordenadas aparecerán aquí';
       }
   }
   // Añadir un botón personalizado para dibujar circunferencias
   const circleButton = document.createElement('button');
   circleButton.innerHTML = 'Dibujar circunferencia';
   circleButton.onclick = () => {
       map.once('click', function(e) {
           const center = [e.lngLat.lng, e.lngLat.lat];
           const radius = 0.01; // Radio en grados (aproximado)
           const points = 64; // Número de puntos para la circunferencia
           const circle = createCircle(center, radius, points);
           // Añadir la circunferencia al mapa como una geometría de Draw
           Draw.add({
               type: 'Feature',
               geometry: {
                   type: 'Polygon',
                   coordinates: [circle]
               }
           });
       });
       alert('Haz clic en el mapa para definir el centro de la circunferencia.');
   };
   // Crear la circunferencia
   function createCircle(center, radius, points) {
       const coordinates = [];
       for (let i = 0; i < points; i++) {
           const angle = (i / points) * (2 * Math.PI);
           const dx = radius * Math.cos(angle);
           const dy = radius * Math.sin(angle);
           coordinates.push([center[0] + dx, center[1] + dy]);
       }
       // Cerrar el polígono
       coordinates.push(coordinates[0]);
       return coordinates;
   }
   // Añadir el botón al control de Mapbox Draw
   const drawControls = document.querySelector('.mapboxgl-ctrl.mapboxgl-ctrl-group');
   drawControls.appendChild(circleButton);
</script>
</body>
</html>
