<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mapbox Draw Example with Circles</title>
<link href="https://api.mapbox.com/mapbox-gl-js/v2.8.2/mapbox-gl.css" rel="stylesheet" />
<link href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.2.0/mapbox-gl-draw.css" rel="stylesheet" />
<script src="https://api.mapbox.com/mapbox-gl-js/v2.8.2/mapbox-gl.js"></script>
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.2.0/mapbox-gl-draw.js"></script>
<style>
       body { margin: 0; padding: 0; }
       #map { width: 100%; height: 100vh; } /* Ajustar la altura del mapa */
       #circle-button {
           position: absolute;
           top: 10px;
           left: 10px;
           background: white;
           padding: 10px;
           cursor: pointer;
           z-index: 1;
           border: 1px solid black;
           border-radius: 5px;
       }
</style>
</head>
<body>
<div id="map"></div> <!-- Este div contendrá el mapa -->
<button id="circle-button">Dibujar Círculo</button>
<script>
       // Establece tu token de acceso a Mapbox
       mapboxgl.accessToken = 'pk.eyJ1IjoiY2JyZWRlc2lnbiIsImEiOiJjbGE4MndlZ3AwMjZjM3ZtaXUwdG1rdjNvIn0.xmG8u3enVaFzhNdsS_H0Ug';
       // Inicializa el mapa
       var map = new mapboxgl.Map({
           container: 'map', // ID del div donde se mostrará el mapa
           style: 'mapbox://styles/mapbox/streets-v11', // Estilo del mapa
           center: [-74.006, 40.7128], // Posición inicial [lng, lat]
           zoom: 10 // Nivel de zoom inicial
       });
       // Inicializa Mapbox Draw
       var Draw = new MapboxDraw({
           displayControlsDefault: true,
           controls: {
               polygon: true,
               line_string: true,
               point: true,
               trash: true
           }
       });
       map.addControl(Draw); // Agrega el control de Mapbox Draw al mapa
       // Manejar eventos de dibujo
       map.on('draw.create', updateArea);
       map.on('draw.update', updateArea);
       map.on('draw.delete', updateArea);
       function updateArea(e) {
           var data = Draw.getAll();
           console.log(data); // Puedes usar los datos de geometría como desees
       }
       // Función para calcular un polígono circular
       function createCircle(center, radiusInKm, points = 64) {
           const coords = [];
           const distanceInMeters = radiusInKm * 1000;
           for (let i = 0; i < points; i++) {
               const angle = (i / points) * (2 * Math.PI);
               const dx = distanceInMeters * Math.cos(angle);
               const dy = distanceInMeters * Math.sin(angle);
               const offsetLng = dx / (111320 * Math.cos(center[1] * (Math.PI / 180)));
               const offsetLat = dy / 110540;
               coords.push([center[0] + offsetLng, center[1] + offsetLat]);
           }
           coords.push(coords[0]); // Cierra el polígono
           return {
               type: 'Feature',
               geometry: {
                   type: 'Polygon',
                   coordinates: [coords]
               }
           };
       }
       // Botón para dibujar un círculo
       document.getElementById('circle-button').addEventListener('click', () => {
           // Inicia el proceso de dibujo de círculo
           map.once('click', (e) => {
               const center = [e.lngLat.lng, e.lngLat.lat]; // Centro del círculo
               const radius = prompt('Ingresa el radio del círculo en kilómetros:', 1); // Solicitar radio al usuario
               if (radius && !isNaN(radius)) {
                   const circle = createCircle(center, parseFloat(radius));
                   Draw.add(circle); // Agrega el círculo como un polígono
               } else {
                   alert('Por favor, ingresa un número válido para el radio.');
               }
           });
           alert('Haz clic en el mapa para establecer el centro del círculo.');
       });
</script>
</body>
</html>
